# Nixpacks configuration for Railway Railpack
# This configures Railpack to work with our custom directory structure

[providers]
php = "8.2"
node = "20"

# Install phase - override default to use correct directories
[phases.install]
dependsOn = ["setup"]
cmds = [
    "cd backend && composer install --optimize-autoloader --no-scripts --no-interaction || exit 1",
    "cd frontend && npm ci || exit 1"
]

# Build phase - override default to use correct directories
[phases.build]
dependsOn = ["install"]
cmds = [
    "cd frontend && npm run build || exit 1",
    "cd backend && mkdir -p storage/framework/sessions storage/framework/views storage/framework/cache storage/framework/testing storage/logs bootstrap/cache",
    "cd backend && chmod -R 775 storage bootstrap/cache 2>/dev/null || true"
]

# Start command
[start]
cmd = "bash start.sh"

