# Nixpacks configuration for Railway
# This configures the build process for the custom directory structure

[providers]
php = "8.2"
node = "20"

[variables]
COMPOSER_DIR = "backend"
NPM_DIR = "frontend"

[phases.install]
dependsOn = ["setup"]
cmds = [
    "cd backend && composer install --optimize-autoloader --no-scripts --no-interaction",
    "cd frontend && npm ci"
]

[phases.build]
dependsOn = ["install"]
cmds = [
    "cd frontend && npm run build",
    "cd backend && mkdir -p storage/framework/sessions storage/framework/views storage/framework/cache storage/framework/testing storage/logs bootstrap/cache",
    "cd backend && chmod -R 775 storage bootstrap/cache || true"
]

[start]
cmd = "bash start.sh"

